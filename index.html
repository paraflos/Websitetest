<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalender med Google-login</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f2f2f2; margin: 0; padding: 20px; }
  #calendar-container { display: none; max-width: 900px; margin: auto; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
  .calendar-header { background-color: #4CAF50; color: white; text-align: center; padding: 20px; font-size: 24px; display: flex; justify-content: center; align-items: center; gap: 20px; }
  .calendar-header button { background: transparent; color: white; border: none; font-size: 28px; cursor: pointer; }
  .calendar-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
  .calendar-table th, .calendar-table td { width: 12.5%; border: 1px solid #ddd; text-align: center; padding: 20px; vertical-align: top; word-wrap: break-word; }
  .calendar-table th:first-child, .calendar-table td:first-child { width: 5%; background-color: #f0f0f0; font-size: 12px; font-weight: bold; }
  .week-number { background-color: #f0f0f0; font-size: 12px; font-weight: bold; padding: 10px 5px; }
  .calendar-day { cursor: pointer; min-height: 60px; position: relative; transition: background-color 0.2s ease; }
  .calendar-day:hover { background-color: #f9f9f9; }
  .calendar-day.has-event { background-color: #e0f7e0; }
  .event-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                 background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.3);
                 z-index: 1000; width: 320px; max-width: 90%; }
  .event-popup input, .event-popup textarea { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;
                                             font-size: 14px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; }
  .event-popup button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 14px; }
  .event-popup button:hover { background-color: #45a049; }
  .event-popup .close { position: absolute; top: 8px; right: 12px; font-size: 18px; border: none; background: none; cursor: pointer; color: #666; font-weight: bold; }
  #login-section { text-align: center; margin-bottom: 20px; }
  #logoutBtn { display: none; }
  .day-button { background-color: #007BFF; color: white; border: none; padding: 15px 25px; font-size: 18px; border-radius: 25px; margin: 5px; cursor: pointer; transition: background-color 0.3s, transform 0.3s; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
  .day-button:hover { background-color: #0056b3; transform: translateY(-2px); }
</style>
</head>
<body>

<div id="login-section">
  <button id="googleLogin">Logga in med Google</button>
  <button id="logoutBtn">Logga ut</button>
  <p id="user-info"></p>
</div>

<div class="calendar" id="calendar-container">
  <div class="calendar-header">
    <button onclick="changeMonth(-1)">â—€</button>
    <span id="calendar-header"></span>
    <button onclick="changeMonth(1)">â–¶</button>
  </div>
  <table class="calendar-table" id="calendar-table"></table>

  <h2>VÃ¤lj dag:</h2>
  <div id="day-buttons">
    <button class="day-button">MÃ¥ndag</button>
    <button class="day-button">Tisdag</button>
    <button class="day-button">Onsdag</button>
    <button class="day-button">Torsdag</button>
    <button class="day-button">Fredag</button>
    <button class="day-button">LÃ¶rdag</button>
    <button class="day-button">SÃ¶ndag</button>
  </div>
</div>

<div class="event-popup" id="event-popup">
  <button class="close" onclick="closePopup()">Ã—</button>
  <h3>HÃ¤ndelse fÃ¶r <span id="event-date"></span></h3>
  <input type="text" id="event-title" placeholder="Titel" />
  <textarea id="event-description" placeholder="Beskrivning" rows="4"></textarea>
  <button onclick="saveEvent()">Spara</button>
  <button onclick="clearEvent()" style="background-color: #d9534f; margin-left: 10px;">Rensa</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"></script>

<script>
  // ðŸ”¥ Klistra in din egen config hÃ¤r
  const firebaseConfig = {
    apiKey: "AIzaSyC84mk3Jsw3G9UTavF71ckPfZOUvipzGk0",
    authDomain: "calendertestv1.firebaseapp.com",
    projectId: "calendertestv1",
    storageBucket: "calendertestv1.firebasestorage.app",
    messagingSenderId: "238645323183",
    appId: "1:238645323183:web:f4866217bfa9740297fb5a",
    measurementId: "G-ZW71E6Z68M"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const months = ["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"];
  const weekdays = ["SÃ¶n","MÃ¥n","Tis","Ons","Tor","Fre","LÃ¶r"];
  let selectedDate = null;
  let currentYear = new Date().getFullYear();
  let currentMonth = new Date().getMonth();
  let events = {};

  function getWeekNumber(date) {
    const temp = new Date(date.getTime());
    temp.setHours(0,0,0,0);
    temp.setDate(temp.getDate() + 4 - (temp.getDay() || 7));
    const yearStart = new Date(temp.getFullYear(),0,1);
    return Math.ceil((((temp - yearStart)/86400000)+1)/7);
  }

  function renderCalendar() {
    const year = currentYear;
    const month = currentMonth;
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);

    document.getElementById('calendar-header').textContent = `${months[month]} ${year}`;
    const table = document.getElementById('calendar-table');
    table.innerHTML = "";

    const thead = table.createTHead();
    const headRow = thead.insertRow();
    const weekHead = document.createElement('th');
    weekHead.textContent = "Vecka";
    headRow.appendChild(weekHead);
    weekdays.forEach(day => {
      const th = document.createElement('th');
      th.textContent = day;
      headRow.appendChild(th);
    });

    const tbody = table.createTBody();
    let row = tbody.insertRow();
    let currentDate = new Date(year, month, 1);
    const firstWeekNumber = getWeekNumber(currentDate);
    let weekCell = row.insertCell();
    weekCell.className = 'week-number';
    weekCell.textContent = "v. " + firstWeekNumber;

    for (let i = 0; i < currentDate.getDay(); i++) {
      row.insertCell();
    }

    for (let day = 1; day <= lastDay.getDate(); day++) {
      currentDate = new Date(year, month, day);
      if (row.cells.length === 8) {
        row = tbody.insertRow();
        const weekNum = getWeekNumber(currentDate);
        const weekCell = row.insertCell();
        weekCell.className = 'week-number';
        weekCell.textContent = "v. " + weekNum;
      }
      const cell = row.insertCell();
      cell.className = 'calendar-day';
      cell.textContent = day;
      cell.onclick = () => showPopup(year, month, day);
      const dateString = currentDate.toISOString().split('T')[0];
      if (events[dateString]) { cell.classList.add('has-event'); }
    }
  }

  function showPopup(year, month, day) {
    selectedDate = new Date(year, month, day);
    const dateString = selectedDate.toISOString().split('T')[0];
    const event = events[dateString] || {};
    document.getElementById('event-date').textContent = dateString;
    document.getElementById('event-title').value = event.title || '';
    document.getElementById('event-description').value = event.description || '';
    document.getElementById('event-popup').style.display = 'block';
  }
  function closePopup() { document.getElementById('event-popup').style.display = 'none'; }

  function saveEvent() {
    if (!selectedDate) return;
    const title = document.getElementById('event-title').value.trim();
    const description = document.getElementById('event-description').value.trim();
    const dateString = selectedDate.toISOString().split('T')[0];
    const user = auth.currentUser;
    if (!user) return alert("Logga in fÃ¶rst!");

    db.collection("users").doc(user.uid).collection("events").doc(dateString).set({
      title, description
    }).then(() => {
      events[dateString] = {title, description};
      closePopup();
      renderCalendar();
    });
  }

  function clearEvent() {
    if (!selectedDate) return;
    const dateString = selectedDate.toISOString().split('T')[0];
    const user = auth.currentUser;
    if (!user) return;

    db.collection("users").doc(user.uid).collection("events").doc(dateString).delete().then(() => {
      delete events[dateString];
      closePopup();
      renderCalendar();
    });
  }

  function changeMonth(direction) {
    currentMonth += direction;
    if (currentMonth < 0) { currentMonth = 11; currentYear--; }
    else if (currentMonth > 11) { currentMonth = 0; currentYear++; }
    renderCalendar();
  }

  // ðŸ”¥ Google-login
  document.getElementById("googleLogin").addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(console.error);
  });

  document.getElementById("logoutBtn").addEventListener("click", () => auth.signOut());

  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById("calendar-container").style.display = "block";
      document.getElementById("googleLogin").style.display = "none";
      document.getElementById("logoutBtn").style.display = "inline-block";
      document.getElementById("user-info").textContent = "Inloggad som: " + user.displayName;

      // Ladda events
      db.collection("users").doc(user.uid).collection("events").get().then(snapshot => {
        events = {};
        snapshot.forEach(doc => { events[doc.id] = doc.data(); });
        renderCalendar();
      });
    } else {
      document.getElementById("calendar-container").style.display = "none";
      document.getElementById("googleLogin").style.display = "inline-block";
      document.getElementById("logoutBtn").style.display = "none";
      document.getElementById("user-info").textContent = "";
    }
  });

  renderCalendar();
</script>

</body>
</html>